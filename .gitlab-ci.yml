stages:
  - build
  - test

# Use a Docker image that includes Java, Gradle, and Chrome
image: gradle:8.11.1-jdk21

# Cache Gradle dependencies to speed up the pipeline
cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
    - .gradle/
    - build/

# Before script: Install Google Chrome and ChromeDriver for Selenium
before_script:
  - apt-get update && apt-get install -y wget curl unzip
  - wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
  - dpkg -i google-chrome-stable_current_amd64.deb
  - apt-get install -f
  - CHROME_DRIVER_VERSION=$(curl -sS chromedriver.storage.googleapis.com/LATEST_RELEASE)
  - wget https://chromedriver.storage.googleapis.com/${CHROME_DRIVER_VERSION}/chromedriver_linux64.zip
  - unzip chromedriver_linux64.zip
  - mv chromedriver /usr/local/bin/

# Job: Build the project
build:
  stage: build
  script:
    - gradle clean build
  artifacts:
    paths:
      - build/libs/*.jar
    expire_in: 1 hour

# Job: Run tests
test:
  stage: test
  script:
    - gradle test
  artifacts:
    when: always
    paths:
      - build/test-logs/
    expire_in: 1 hour
